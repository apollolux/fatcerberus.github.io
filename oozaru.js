var main=function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);const i="Oozaru",n="0.1.0",s=2,a=3;class o{constructor(t){this.ptr=0,this.textDec=new TextDecoder,ArrayBuffer.isView(t)?this.bytes=new Uint8Array(t.buffer):this.bytes=new Uint8Array(t),this.view=new DataView(this.bytes.buffer)}get atEOF(){return this.ptr>=this.bytes.length}get bufferSize(){return this.bytes.length}get position(){return this.ptr}set position(t){if(t>this.bytes.length)throw new RangeError(`Stream position '${t}' is out of range`);this.ptr=t}readBytes(t){if(this.ptr+t>this.bytes.length)throw new Error(`Unable to read ${t} bytes from stream`);const e=this.bytes.slice(this.ptr,this.ptr+t);return this.ptr+=t,e}readFloat32(t=!1){if(this.ptr+4>this.bytes.length)throw new Error("Unable to read 32-bit float from stream");const e=this.view.getFloat32(this.ptr,t);return this.ptr+=4,e}readFloat64(t=!1){if(this.ptr+8>this.bytes.length)throw new Error("Unable to read 64-bit float from stream");const e=this.view.getFloat64(this.ptr,t);return this.ptr+=8,e}readInt8(){if(this.ptr+1>this.bytes.length)throw new Error("Unable to read 8-bit signed integer from stream");return this.view.getInt8(this.ptr++)}readInt16(t=!1){if(this.ptr+2>this.bytes.length)throw new Error("Unable to read 16-bit signed integer from stream");const e=this.view.getInt16(this.ptr,t);return this.ptr+=2,e}readInt32(t=!1){if(this.ptr+4>this.bytes.length)throw new Error("Unable to read 32-bit signed integer from stream");const e=this.view.getInt32(this.ptr,t);return this.ptr+=4,e}readString(t){if(this.ptr+t>this.bytes.length)throw new Error(`Unable to read ${t}-byte string from stream`);const e=this.bytes.subarray(this.ptr,this.ptr+t);return this.ptr+=t,this.textDec.decode(e)}readStringU8(){const t=this.readUint8();return this.readString(t)}readStringU16(t=!1){const e=this.readUint16(t);return this.readString(e)}readStringU32(t=!1){const e=this.readUint32(t);return this.readString(e)}readStruct(t){let e={};for(const r of Object.keys(t)){const i=t[r].match(/(string|reserve)\/([0-9]*)/),n=null!==i?i[1]:t[r],s=null!==i?parseInt(i[2],10):0;switch(n){case"float32-be":e[r]=this.readFloat32();break;case"float32-le":e[r]=this.readFloat32(!0);break;case"float64-be":e[r]=this.readFloat64();break;case"float64-le":e[r]=this.readFloat64(!0);break;case"int8":case"int8-be":case"int8-le":e[r]=this.readInt8();break;case"int16-be":e[r]=this.readInt16();break;case"int16-le":e[r]=this.readInt16(!0);break;case"int32-be":e[r]=this.readInt32();break;case"int32-le":e[r]=this.readInt32(!0);break;case"reserve":e[r]=null,this.skipAhead(s);break;case"string":e[r]=this.readString(s);break;case"string8":case"string8-be":case"string8-le":e[r]=this.readStringU8();break;case"string16-be":e[r]=this.readStringU16();break;case"string16-le":e[r]=this.readStringU16(!0);break;case"string32-be":e[r]=this.readStringU32();break;case"string32-le":e[r]=this.readStringU32(!0);break;case"uint8":case"uint8-be":case"uint8-le":e[r]=this.readUint8();break;case"uint16-be":e[r]=this.readUint16();break;case"uint16-le":e[r]=this.readUint16(!0);break;case"uint32-be":e[r]=this.readUint32();break;case"uint32-le":e[r]=this.readUint32(!0);break;default:throw new RangeError(`Unknown readStruct() value type '${n}'`)}}return e}readUint8(){if(this.ptr+1>this.bytes.length)throw new Error("Unable to read 8-bit unsigned integer from stream");return this.view.getUint8(this.ptr++)}readUint16(t=!1){if(this.ptr+2>this.bytes.length)throw new Error("Unable to read 16-bit unsigned integer from stream");const e=this.view.getUint16(this.ptr,t);return this.ptr+=2,e}readUint32(t=!1){if(this.ptr+4>this.bytes.length)throw new Error("Unable to read 32-bit unsigned integer from stream");const e=this.view.getUint32(this.ptr,t);return this.ptr+=4,e}skipAhead(t){if(this.ptr+t>this.bytes.length)throw new Error(`Cannot read ${t} bytes from stream`);this.ptr+=t}}var u=function(t,e,r,i){return new(r||(r=Promise))(function(n,s){function a(t){try{u(i.next(t))}catch(t){s(t)}}function o(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(a,o)}u((i=i.apply(t,e||[])).next())})};function h(t){return u(this,void 0,void 0,function*(){return(yield fetch(t)).json()})}function l(t){return u(this,void 0,void 0,function*(){const e=`$moduleNS$${Math.random().toString(32).slice(2)}`,r=window,i=function(t){const e=document.createElement("a");return e.setAttribute("href",t),e.cloneNode(!1).href}(t),n=new Blob([`\n\t\timport * as module from "${i}";\n\t\twindow.${e} = module;\n\t`],{type:"text/javascript"});return new Promise((i,s)=>{const a=document.createElement("script");a.type="module";const o=()=>{delete r[e],a.remove(),URL.revokeObjectURL(a.src)};a.onload=()=>{i(r[e]),o()},a.onerror=()=>{s(new Error(`Unable to load JS module '${t}'`)),o()},a.src=URL.createObjectURL(n),document.head.appendChild(a)})})}function c(t){return u(this,void 0,void 0,function*(){return(yield fetch(t)).arrayBuffer()})}function d(t){return u(this,void 0,void 0,function*(){return(yield fetch(t)).text()})}function f(t){return new Promise(e=>{e(t())})}var g=function(t,e,r,i){return new(r||(r=Promise))(function(n,s){function a(t){try{u(i.next(t))}catch(t){s(t)}}function o(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(a,o)}u((i=i.apply(t,e||[])).next())})};let p,m,w=null,b=null;var y,v,D,E,S;!function(t){t[t.Default=0]="Default",t[t.Add=1]="Add",t[t.Average=2]="Average",t[t.CopyAlpha=3]="CopyAlpha",t[t.CopyRGB=4]="CopyRGB",t[t.Invert=5]="Invert",t[t.Multiply=6]="Multiply",t[t.Replace=7]="Replace",t[t.Subtract=8]="Subtract"}(y||(y={})),function(t){t[t.AlwaysPass=0]="AlwaysPass",t[t.Equal=1]="Equal",t[t.Greater=2]="Greater",t[t.GreaterOrEqual=3]="GreaterOrEqual",t[t.Less=4]="Less",t[t.LessOrEqual=5]="LessOrEqual",t[t.NeverPass=6]="NeverPass",t[t.NotEqual=7]="NotEqual"}(v||(v={})),function(t){t[t.Fan=0]="Fan",t[t.Lines=1]="Lines",t[t.LineLoop=2]="LineLoop",t[t.LineStrip=3]="LineStrip",t[t.Points=4]="Points",t[t.Triangles=5]="Triangles",t[t.TriStrip=6]="TriStrip"}(D||(D={}));class k extends(null){static initialize(t){return g(this,void 0,void 0,function*(){const e={alpha:!1,preserveDrawingBuffer:!0},r=t.getContext("webgl2",e)||t.getContext("webgl",e)||t.getContext("experimental-webgl",e);if(null===r)throw new Error("Unable to acquire WebGL rendering context");r.clearColor(0,0,0,1),r.clearDepth(1),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.depthFunc(r.LEQUAL),r.enable(r.BLEND),r.enable(r.DEPTH_TEST),r.enable(r.SCISSOR_TEST),p=r,m=t,x.Screen.activate()})}}class x{constructor(t){this.blendOp_=y.Default,this.depthOp_=v.LessOrEqual;const e=p.createFramebuffer(),r=p.createRenderbuffer();if(null===e||null===r)throw new Error("Unable to create WebGL framebuffer object");p.bindFramebuffer(p.FRAMEBUFFER,e),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,t.hwTexture,0),p.bindRenderbuffer(p.RENDERBUFFER,r),p.renderbufferStorage(p.RENDERBUFFER,p.DEPTH_COMPONENT16,t.width,t.height),p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,r),this.clipping={x:0,y:0,w:t.width,h:t.height},this.frameBuffer=e,this.texture=t}static get Screen(){const t=Object.create(x.prototype);return t.blendOp_=y.Default,t.clipping={x:0,y:0,w:m.width,h:m.height},t.depthOp_=v.LessOrEqual,t.frameBuffer=null,t.texture=null,Object.defineProperty(x,"Screen",{writable:!1,enumerable:!1,configurable:!0,value:t}),t}get blendOp(){return this.blendOp_}set blendOp(t){this.blendOp_=t,w===this&&B(t)}get depthOp(){return this.depthOp_}set depthOp(t){this.depthOp_=t,w===this&&I(t)}get height(){return null!==this.texture?this.texture.height:m.height}get width(){return null!==this.texture?this.texture.width:m.width}activate(){w!==this&&(p.bindFramebuffer(p.FRAMEBUFFER,this.frameBuffer),null!==this.texture?p.viewport(0,0,this.texture.width,this.texture.height):p.viewport(0,0,m.width,m.height),p.scissor(this.clipping.x,this.clipping.y,this.clipping.w,this.clipping.h),B(this.blendOp_),I(this.depthOp_),w=this)}clipTo(t,e,r,i){this.clipping.x=t,this.clipping.y=e,this.clipping.w=r,this.clipping.h=i,this===w&&p.scissor(t,this.height-e-i,r,i)}unclip(){this.clipping.x=0,this.clipping.y=0,this.clipping.w=this.width,this.clipping.h=this.height,this===w&&p.scissor(0,0,this.width,this.height)}}class P{constructor(t){this.glyphs=[],this.lineHeight=0,this.maxWidth=0,this.numGlyphs=0,this.vertexBuffer=new U;let e=new o(t),r=e.readStruct({signature:"string/4",version:"uint16-le",numGlyphs:"uint16-le",reserved:"reserve/248"});if(".rfn"!==r.signature)throw new Error("Unable to load RFN font file");if(r.version<2||r.version>2)throw new Error(`Unsupported RFN version '${r.version}'`);if(r.numGlyphs<=0)throw new Error("Malformed RFN font (no glyphs)");const i=Math.ceil(Math.sqrt(r.numGlyphs));this.stride=1/i;for(let t=0;t<r.numGlyphs;++t){let r=e.readStruct({width:"uint16-le",height:"uint16-le",reserved:"reserve/28"});this.lineHeight=Math.max(this.lineHeight,r.height),this.maxWidth=Math.max(this.maxWidth,r.width);const n=e.readBytes(r.width*r.height*4);this.glyphs.push({width:r.width,height:r.height,u:t%i/i,v:1-Math.floor(t/i)/i,pixelData:n})}this.atlas=new O(i*this.maxWidth,i*this.lineHeight),this.numGlyphs=r.numGlyphs;for(let t=0;t<this.numGlyphs;++t){const e=this.glyphs[t],r=t%i*this.maxWidth,n=Math.floor(t/i)*this.lineHeight;this.atlas.upload(e.pixelData,r,n,e.width,e.height)}}static fromFile(t){return g(this,void 0,void 0,function*(){return new this(yield c(t))})}get height(){return this.lineHeight}drawText(t,e,r){if(""===t)return;let i;null!==b&&(b.activate(!0),b.transform(r)),this.atlas.activate(0);let n=0,s=0;const a=[];for(;void 0!==(i=t.codePointAt(n++));){i>65535&&++n,(i=8364==i?128:8218==i?130:402==i?131:8222==i?132:8230==i?133:8224==i?134:8225==i?135:710==i?136:8240==i?137:352==i?138:8249==i?139:338==i?140:381==i?142:8216==i?145:8217==i?146:8220==i?147:8221==i?148:8226==i?149:8211==i?150:8212==i?151:732==i?152:8482==i?153:353==i?154:8250==i?155:339==i?156:382==i?158:376==i?159:i)>=this.numGlyphs&&(i=26);const t=this.glyphs[i],r=s,o=r+t.width,u=0,h=u+t.height,l=t.u,c=l+t.width/this.maxWidth*this.stride,d=t.v,f=d-t.height/this.lineHeight*this.stride;a.push({x:r,y:u,u:l,v:d,color:e},{x:o,y:u,u:c,v:d,color:e},{x:r,y:h,u:l,v:f,color:e},{x:o,y:u,u:c,v:d,color:e},{x:r,y:h,u:l,v:f,color:e},{x:o,y:h,u:c,v:f,color:e}),s+=t.width}this.vertexBuffer.upload(a),A.draw(this.vertexBuffer,null,D.Triangles)}widthOf(t){let e,r=0,i=0;for(;void 0!==(e=t.codePointAt(r++));){e>65535&&++r,(e=8364==e?128:8218==e?130:402==e?131:8222==e?132:8230==e?133:8224==e?134:8225==e?135:710==e?136:8240==e?137:352==e?138:8249==e?139:338==e?140:381==e?142:8216==e?145:8217==e?146:8220==e?147:8221==e?148:8226==e?149:8211==e?150:8212==e?151:732==e?152:8482==e?153:353==e?154:8250==e?155:339==e?156:382==e?158:376==e?159:e)>=this.numGlyphs&&(e=26),i+=this.glyphs[e].width}return i}wordWrap(t,e){const r=[];let i,n=[],s="",a=0,o=!1,u=0,h=!1,l=0;for(;void 0!==(i=t.codePointAt(l++));){i>65535&&++l,(i=8364==i?128:8218==i?130:402==i?131:8222==i?132:8230==i?133:8224==i?134:8225==i?135:710==i?136:8240==i?137:352==i?138:8249==i?139:338==i?140:381==i?142:8216==i?145:8217==i?146:8220==i?147:8221==i?148:8226==i?149:8211==i?150:8212==i?151:732==i?152:8482==i?153:353==i?154:8250==i?155:339==i?156:382==i?158:376==i?159:i)>=this.numGlyphs&&(i=26);const c=this.glyphs[i];switch(i){case 13:case 10:13===i&&10==t.codePointAt(l)&&++l,o=!0;break;case 8:n.push(i),u+=3*this.glyphs[32].width,h=!0;break;case 32:n.push(i),u+=c.width,h=!0;break;default:n.push(i),u+=c.width}(h||o)&&(s+=String.fromCodePoint(...n),a+=u,n.length=0,u=0,h=!1),(a+u>e||o)&&(r.push(s),s="",a=0,o=!1)}return""!==(s+=String.fromCodePoint(...n))&&r.push(s),r}}class R{constructor(t){this.hwBuffer=null,this.length=0,this.maxItems=0,this.streamable=void 0===t,void 0!==t&&this.upload(t)}activate(){p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,this.hwBuffer)}upload(t){const e=new Uint16Array(t);if(this.length=e.length,this.length<=this.maxItems&&null!==this.hwBuffer)p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,this.hwBuffer),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,e);else{if(p.deleteBuffer(this.hwBuffer),this.hwBuffer=p.createBuffer(),null===this.hwBuffer)throw new Error("Unable to create WebGL index buffer object");p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,this.hwBuffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,e,this.streamable?p.STREAM_DRAW:p.STATIC_DRAW),this.length=e.length,this.maxItems=this.length}}}class T{static get Identity(){return(new this).identity()}constructor(t){this.values=void 0!==t?new Float32Array(t):new Float32Array(16)}clone(){const t=new T;return t.values.set(this.values),t}composeWith(t){const e=this.values,r=t.values,i=r[0],n=r[1],s=r[2],a=r[3],o=r[4],u=r[5],h=r[6],l=r[7],c=r[8],d=r[9],f=r[10],g=r[11],p=r[12],m=r[13],w=r[14],b=r[15],y=e[0],v=e[1],D=e[2],E=e[3],S=e[4],k=e[5],x=e[6],P=e[7],R=e[8],T=e[9],A=e[10],F=e[11],L=e[12],O=e[13],U=e[14],B=e[15];return e[0]=y*i+v*o+D*c+E*p,e[1]=y*n+v*u+D*d+E*m,e[2]=y*s+v*h+D*f+E*w,e[3]=y*a+v*l+D*g+E*b,e[4]=S*i+k*o+x*c+P*p,e[5]=S*n+k*u+x*d+P*m,e[6]=S*s+k*h+x*f+P*w,e[7]=S*a+k*l+x*g+P*b,e[8]=R*i+T*o+A*c+F*p,e[9]=R*n+T*u+A*d+F*m,e[10]=R*s+T*h+A*f+F*w,e[11]=R*a+T*l+A*g+F*b,e[12]=L*i+O*o+U*c+B*p,e[13]=L*n+O*u+U*d+B*m,e[14]=L*s+O*h+U*f+B*w,e[15]=L*a+O*l+U*g+B*b,this}identity(){return this.values.set([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this}ortho(t,e,r,i,n=-1,s=1){const a=r-t,o=e-i,u=s-n,h=new T,l=h.values;return l[0]=2/a,l[5]=2/o,l[10]=2/u,l[15]=1,l[12]=-(r+t)/a,l[13]=-(e+i)/o,l[14]=-(s+n)/u,this.composeWith(h)}perspective(t,e,r,i,n,s){const a=r-t,o=e-i,u=s-n,h=new T,l=h.values;return l[0]=2*n/a,l[5]=2*n/o,l[8]=(r+t)/a,l[9]=(e+i)/o,l[10]=-(s+n)/u,l[11]=-1,l[14]=-2*s*n/u,l[15]=0,this.composeWith(h)}rotate(t,e,r,i){const n=Math.cos(t),s=Math.sin(t),a=1-n,o=new T,u=o.values;return u[0]=a*e*e+n,u[1]=a*e*r+i*s,u[2]=a*e*i-r*s,u[4]=a*e*r-i*s,u[5]=a*r*r+n,u[6]=a*i*r+e*s,u[8]=a*e*i+r*s,u[9]=a*r*i-e*s,u[10]=a*i*i+n,u[15]=1,this.composeWith(o)}scale(t,e,r=1){return this.values[0]*=t,this.values[4]*=t,this.values[8]*=t,this.values[12]*=t,this.values[1]*=e,this.values[5]*=e,this.values[9]*=e,this.values[13]*=e,this.values[2]*=r,this.values[6]*=r,this.values[10]*=r,this.values[14]*=r,this}translate(t,e,r=0){return this.values[12]+=t,this.values[13]+=e,this.values[14]+=r,this}}class A extends(null){static clear(){p.disable(p.SCISSOR_TEST),p.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT),p.enable(p.SCISSOR_TEST)}static draw(t,e,r,i=0,n){const s=r===D.Fan?p.TRIANGLE_FAN:r===D.Lines?p.LINES:r===D.LineLoop?p.LINE_LOOP:r===D.LineStrip?p.LINE_STRIP:r===D.Points?p.POINTS:r===D.TriStrip?p.TRIANGLE_STRIP:p.TRIANGLES;t.activate(),null!==e?(void 0===n&&(n=e.length-i),e.activate(),p.drawElements(s,n,p.UNSIGNED_SHORT,i)):(void 0===n&&(n=t.length-i),p.drawArrays(s,0,n))}static rerez(t,e){m.width=t,m.height=e,t<=400&&e<=300?(m.style.width=`${2*t}px`,m.style.height=`${2*e}px`):(m.style.width=`${t}px`,m.style.height=`${e}px`),w===x.Screen&&p.viewport(0,0,m.width,m.height)}}class F{constructor(t,e){this.deferredValues={},this.uniformIDs={};const r=p.createProgram(),i=p.createShader(p.VERTEX_SHADER),n=p.createShader(p.FRAGMENT_SHADER);if(null===r||null===i||null===n)throw new Error("Unable to create WebGL shader program object");if(p.shaderSource(i,t),p.shaderSource(n,e),p.compileShader(i),!p.getShaderParameter(i,p.COMPILE_STATUS)){const t=p.getShaderInfoLog(i);throw new Error(`Couldn't compile vertex shader...\n${t}`)}if(p.compileShader(n),!p.getShaderParameter(n,p.COMPILE_STATUS)){const t=p.getShaderInfoLog(n);throw new Error(`Couldn't compile fragment shader...\n${t}`)}if(p.attachShader(r,i),p.attachShader(r,n),p.bindAttribLocation(r,0,"al_pos"),p.bindAttribLocation(r,1,"al_color"),p.bindAttribLocation(r,2,"al_texcoord"),p.linkProgram(r),!p.getProgramParameter(r,p.LINK_STATUS)){const t=p.getProgramInfoLog(r);throw new Error(`Couldn't link shader program...\n${t}`)}this.program=r,this.hasTextureLoc=p.getUniformLocation(r,"al_use_tex"),this.modelViewLoc=p.getUniformLocation(r,"al_projview_matrix"),this.textureLoc=p.getUniformLocation(r,"al_tex"),this.projection=T.Identity,this.modelView=T.Identity}activate(t){if(b!==this){let t=this.modelView.clone().composeWith(this.projection);p.useProgram(this.program),p.uniformMatrix4fv(this.modelViewLoc,!1,t.values),p.uniform1i(this.textureLoc,0);for(const t of Object.keys(this.deferredValues)){const e=this.deferredValues[t],r=this.uniformIDs[t];let i;switch(e.type){case"bool":p.uniform1i(r,e.value?1:0);break;case"float":p.uniform1f(r,e.value);break;case"floatArray":p.uniform1fv(r,e.value);break;case"floatVec":4===(i=e.value.length)?p.uniform4fv(r,e.value):3===i?p.uniform3fv(r,e.value):2===i?p.uniform2fv(r,e.value):p.uniform1fv(r,e.value);break;case"int":p.uniform1i(r,e.value);break;case"intArray":p.uniform1iv(r,e.value);break;case"intVec":4===(i=e.value.length)?p.uniform4iv(r,e.value):3===i?p.uniform3iv(r,e.value):2===i?p.uniform2iv(r,e.value):p.uniform1iv(r,e.value);break;case"matrix":p.uniformMatrix4fv(r,!1,e.value.values)}}this.deferredValues={},b=this}p.uniform1i(this.hasTextureLoc,t?1:0)}project(t){if(this.projection=t.clone(),b===this){let t=this.modelView.clone().composeWith(this.projection);p.uniformMatrix4fv(this.modelViewLoc,!1,t.values)}}setBoolValue(t,e){let r=this.uniformIDs[t];void 0===r&&(r=p.getUniformLocation(this.program,t),this.uniformIDs[t]=r),b===this?p.uniform1i(r,e?1:0):this.deferredValues[t]={type:"bool",value:e}}setFloatArray(t,e){let r=this.uniformIDs[t];void 0===r&&(r=p.getUniformLocation(this.program,t),this.uniformIDs[t]=r),b===this?p.uniform1fv(r,e):this.deferredValues[t]={type:"floatArray",value:e}}setFloatValue(t,e){let r=this.uniformIDs[t];void 0===r&&(r=p.getUniformLocation(this.program,t),this.uniformIDs[t]=r),b===this?p.uniform1f(r,e):this.deferredValues[t]={type:"float",value:e}}setFloatVec(t,e){let r=this.uniformIDs[t];if(void 0===r&&(r=p.getUniformLocation(this.program,t),this.uniformIDs[t]=r),b===this){const t=e.length;4===t?p.uniform4fv(r,e):3===t?p.uniform3fv(r,e):2===t?p.uniform2fv(r,e):p.uniform1fv(r,e)}else this.deferredValues[t]={type:"floatVec",value:e}}setIntArray(t,e){let r=this.uniformIDs[t];void 0===r&&(r=p.getUniformLocation(this.program,t),this.uniformIDs[t]=r),b===this?p.uniform1iv(r,e):this.deferredValues[t]={type:"intArray",value:e}}setIntValue(t,e){let r=this.uniformIDs[t];void 0===r&&(r=p.getUniformLocation(this.program,t),this.uniformIDs[t]=r),b===this?p.uniform1i(r,e):this.deferredValues[t]={type:"int",value:e}}setIntVec(t,e){let r=this.uniformIDs[t];if(void 0===r&&(r=p.getUniformLocation(this.program,t),this.uniformIDs[t]=r),b===this){const t=e.length;4===t?p.uniform4iv(r,e):3===t?p.uniform3iv(r,e):2===t?p.uniform2iv(r,e):p.uniform1iv(r,e)}else this.deferredValues[t]={type:"intVec",value:e}}setMatrixValue(t,e){let r=this.uniformIDs[t];void 0===r&&(r=p.getUniformLocation(this.program,t),this.uniformIDs[t]=r),b===this?p.uniformMatrix4fv(r,!1,e.values):this.deferredValues[t]={type:"matrix",value:e}}transform(t){if(this.modelView=t.clone(),b===this){let t=this.modelView.clone().composeWith(this.projection);p.uniformMatrix4fv(this.modelViewLoc,!1,t.values)}}}class L{constructor(t,e,r){this.type=r,this.vertices=t,this.indices=e}draw(){A.draw(this.vertices,this.indices,this.type)}}class O{constructor(t,e,r){const i=p.createTexture();if(null===i)throw new Error("Unable to create WebGL texture object");this.hwTexture=i;const n=p.getParameter(p.TEXTURE_BINDING_2D);if(p.bindTexture(p.TEXTURE_2D,this.hwTexture),p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,!0),t instanceof HTMLImageElement)p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,t),this.width=t.width,this.height=t.height;else if(this.width=t,this.height=e,r instanceof ArrayBuffer||ArrayBuffer.isView(r)){const t=r instanceof ArrayBuffer?r:r.buffer;p.texImage2D(p.TEXTURE_2D,0,p.RGBA,this.width,this.height,0,p.RGBA,p.UNSIGNED_BYTE,new Uint8Array(t))}else{let t=new Uint32Array(this.width*this.height);void 0!==r&&t.fill((255*r.a<<24)+(255*r.b<<16)+(255*r.g<<8)+255*r.r),p.texImage2D(p.TEXTURE_2D,0,p.RGBA,this.width,this.height,0,p.RGBA,p.UNSIGNED_BYTE,new Uint8Array(t.buffer))}p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.bindTexture(p.TEXTURE_2D,n)}activate(t=0){p.activeTexture(p.TEXTURE0+t),p.bindTexture(p.TEXTURE_2D,this.hwTexture)}upload(t,e=0,r=0,i=this.width,n=this.height){const s=ArrayBuffer.isView(t)?new Uint8Array(t.buffer):new Uint8Array(t);p.bindTexture(p.TEXTURE_2D,this.hwTexture),p.texSubImage2D(p.TEXTURE_2D,0,e,this.height-r-n,i,n,p.RGBA,p.UNSIGNED_BYTE,s)}}class U{constructor(t){this.hwBuffer=null,this.length=0,this.maxItems=0,this.streamable=void 0===t,void 0!==t&&this.upload(t)}activate(){p.bindBuffer(p.ARRAY_BUFFER,this.hwBuffer),p.enableVertexAttribArray(0),p.enableVertexAttribArray(1),p.enableVertexAttribArray(2),p.vertexAttribPointer(0,4,p.FLOAT,!1,40,0),p.vertexAttribPointer(1,4,p.FLOAT,!1,40,16),p.vertexAttribPointer(2,2,p.FLOAT,!1,40,32)}upload(t){const e=new Float32Array(10*t.length);for(let r=0,i=t.length;r<i;++r){const i=t[r];e[0+10*r]=i.x,e[1+10*r]=i.y,void 0!==i.z&&(e[2+10*r]=i.z),e[3+10*r]=1,void 0!==i.color?(e[4+10*r]=i.color.r,e[5+10*r]=i.color.g,e[6+10*r]=i.color.b,e[7+10*r]=i.color.a):(e[4+10*r]=1,e[5+10*r]=1,e[6+10*r]=1,e[7+10*r]=1),void 0!==i.u&&void 0!==i.v&&(e[8+10*r]=i.u,e[9+10*r]=i.v)}if(this.length=t.length,this.length<=this.maxItems&&null!=this.hwBuffer)p.bindBuffer(p.ARRAY_BUFFER,this.hwBuffer),p.bufferSubData(p.ARRAY_BUFFER,0,e);else{if(p.deleteBuffer(this.hwBuffer),this.hwBuffer=p.createBuffer(),null===this.hwBuffer)throw new Error("Unable to create WebGL vertex buffer object");p.bindBuffer(p.ARRAY_BUFFER,this.hwBuffer),p.bufferData(p.ARRAY_BUFFER,e,this.streamable?p.STREAM_DRAW:p.STATIC_DRAW),this.maxItems=this.length}}}function B(t){switch(t){case y.Default:p.blendEquation(p.FUNC_ADD),p.blendFunc(p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA);break;case y.Add:p.blendEquation(p.FUNC_ADD),p.blendFunc(p.ONE,p.ONE);break;case y.Average:p.blendEquation(p.FUNC_ADD),p.blendFunc(p.CONSTANT_COLOR,p.CONSTANT_COLOR),p.blendColor(.5,.5,.5,.5);break;case y.CopyAlpha:p.blendEquation(p.FUNC_ADD),p.blendFuncSeparate(p.ZERO,p.ONE,p.ONE,p.ZERO);break;case y.CopyRGB:p.blendEquation(p.FUNC_ADD),p.blendFuncSeparate(p.ONE,p.ZERO,p.ZERO,p.ONE);break;case y.Invert:p.blendEquation(p.FUNC_ADD),p.blendFunc(p.ZERO,p.ONE_MINUS_SRC_COLOR);break;case y.Multiply:p.blendEquation(p.FUNC_ADD),p.blendFunc(p.DST_COLOR,p.ZERO);break;case y.Replace:p.blendEquation(p.FUNC_ADD),p.blendFunc(p.ONE,p.ZERO);break;case y.Subtract:p.blendEquation(p.FUNC_REVERSE_SUBTRACT),p.blendFunc(p.ONE,p.ONE);break;default:p.blendEquation(p.FUNC_ADD),p.blendFunc(p.ZERO,p.ZERO)}}function I(t){const e=t===v.AlwaysPass?p.ALWAYS:t===v.Equal?p.EQUAL:t===v.Greater?p.GREATER:t===v.GreaterOrEqual?p.GEQUAL:t===v.Less?p.LESS:t===v.LessOrEqual?p.LEQUAL:t===v.NotEqual?p.NOTEQUAL:p.NEVER;p.depthFunc(e)}!function(t){t[t.Alt=0]="Alt",t[t.AltGr=1]="AltGr",t[t.Apostrophe=2]="Apostrophe",t[t.Backslash=3]="Backslash",t[t.Backspace=4]="Backspace",t[t.CapsLock=5]="CapsLock",t[t.CloseBrace=6]="CloseBrace",t[t.Comma=7]="Comma",t[t.Delete=8]="Delete",t[t.Down=9]="Down",t[t.End=10]="End",t[t.Enter=11]="Enter",t[t.Equals=12]="Equals",t[t.Escape=13]="Escape",t[t.F1=14]="F1",t[t.F2=15]="F2",t[t.F3=16]="F3",t[t.F4=17]="F4",t[t.F5=18]="F5",t[t.F6=19]="F6",t[t.F7=20]="F7",t[t.F8=21]="F8",t[t.F9=22]="F9",t[t.F10=23]="F10",t[t.F11=24]="F11",t[t.F12=25]="F12",t[t.Home=26]="Home",t[t.Hyphen=27]="Hyphen",t[t.Insert=28]="Insert",t[t.LCtrl=29]="LCtrl",t[t.LShift=30]="LShift",t[t.Left=31]="Left",t[t.NumLock=32]="NumLock",t[t.OpenBrace=33]="OpenBrace",t[t.PageDown=34]="PageDown",t[t.PageUp=35]="PageUp",t[t.Period=36]="Period",t[t.RCtrl=37]="RCtrl",t[t.RShift=38]="RShift",t[t.Right=39]="Right",t[t.ScrollLock=40]="ScrollLock",t[t.Semicolon=41]="Semicolon",t[t.Slash=42]="Slash",t[t.Space=43]="Space",t[t.Tab=44]="Tab",t[t.Tilde=45]="Tilde",t[t.Up=46]="Up",t[t.A=47]="A",t[t.B=48]="B",t[t.C=49]="C",t[t.D=50]="D",t[t.E=51]="E",t[t.F=52]="F",t[t.G=53]="G",t[t.H=54]="H",t[t.I=55]="I",t[t.J=56]="J",t[t.K=57]="K",t[t.L=58]="L",t[t.M=59]="M",t[t.N=60]="N",t[t.O=61]="O",t[t.P=62]="P",t[t.Q=63]="Q",t[t.R=64]="R",t[t.S=65]="S",t[t.T=66]="T",t[t.U=67]="U",t[t.V=68]="V",t[t.W=69]="W",t[t.X=70]="X",t[t.Y=71]="Y",t[t.Z=72]="Z",t[t.D1=73]="D1",t[t.D2=74]="D2",t[t.D3=75]="D3",t[t.D4=76]="D4",t[t.D5=77]="D5",t[t.D6=78]="D6",t[t.D7=79]="D7",t[t.D8=80]="D8",t[t.D9=81]="D9",t[t.D0=82]="D0",t[t.NumPad1=83]="NumPad1",t[t.NumPad2=84]="NumPad2",t[t.NumPad3=85]="NumPad3",t[t.NumPad4=86]="NumPad4",t[t.NumPad5=87]="NumPad5",t[t.NumPad6=88]="NumPad6",t[t.NumPad7=89]="NumPad7",t[t.NumPad8=90]="NumPad8",t[t.NumPad9=91]="NumPad9",t[t.NumPad0=92]="NumPad0",t[t.NumPadEnter=93]="NumPadEnter",t[t.Add=94]="Add",t[t.Decimal=95]="Decimal",t[t.Divide=96]="Divide",t[t.Multiply=97]="Multiply",t[t.Subtract=98]="Subtract"}(E||(E={})),function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.WheelUp=5]="WheelUp",t[t.WheelDown=6]="WheelDown"}(S||(S={}));let _=1;var C;!function(t){t[t.Immediate=0]="Immediate",t[t.Render=1]="Render",t[t.Update=2]="Update"}(C||(C={}));var N=function(t,e,r,i){return new(r||(r=Promise))(function(n,s){function a(t){try{u(i.next(t))}catch(t){s(t)}}function o(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(a,o)}u((i=i.apply(t,e||[])).next())})};class M{constructor(){this.jobs=[]}fetch(t){return N(this,void 0,void 0,function*(){const e={url:t,bytesDone:0,totalSize:null};this.jobs.push(e);const r=yield fetch(t);if(null===r.body)throw Error(`Unable to fetch '${t}' (${r.status})`);const i=r.body.getReader(),n=r.headers.get("Content-Length");null!==n&&(e.totalSize=parseInt(n));let s=!1;const a=[];for(;!s;){const{value:t,done:r}=yield i.read();r||(a.push(t),e.bytesDone+=t.length),s=r}return new Blob(a)})}fetchImage(t){return N(this,void 0,void 0,function*(){const e=yield this.fetch(t);return new Promise((r,i)=>{const n=new Image;n.onload=()=>{r(n),URL.revokeObjectURL(n.src)},n.onerror=()=>{i(new Error(`Unable to load image file '${t}'`)),URL.revokeObjectURL(n.src)},n.src=URL.createObjectURL(e)})})}get numJobs(){return this.jobs.length}get progress(){let t=0,e=0;for(let r=0,i=this.jobs.length;r<i;++r){const i=this.jobs[r];null!==i.totalSize&&(t+=i.totalSize,e+=i.bytesDone)}return t>0?e/t:1}}class j{constructor(t=8){this.backPtr=0,this.frontPtr=0,this.vips=[],this.stride=t+1,this.entries=new Array(this.stride),this.overflowPtr=this.stride}*[Symbol.iterator](){for(;!this.empty;)yield this.shift()}get empty(){return this.backPtr===this.frontPtr&&this.overflowPtr===this.stride&&0===this.vips.length}get first(){return this.vips.length>0?this.vips[this.vips.length-1]:this.backPtr!==this.frontPtr?this.entries[this.frontPtr]:this.entries[this.stride]}get last(){const t=this.backPtr>0?this.backPtr-1:this.stride-1;return this.overflowPtr>this.stride?this.entries[this.overflowPtr-1]:this.frontPtr!==this.backPtr?this.entries[t]:this.vips[0]}clear(){this.entries.length=0,this.stride=1,this.overflowPtr=1,this.backPtr=0,this.frontPtr=0}pop(){return this.overflowPtr>this.stride?this.entries[--this.overflowPtr]:this.frontPtr!==this.backPtr?(--this.backPtr<0&&(this.backPtr=this.stride-1),this.entries[this.backPtr]):this.vips.shift()}push(t){(this.backPtr+1)%this.stride===this.frontPtr||this.overflowPtr>this.stride?this.entries[this.overflowPtr++]=t:(this.entries[this.backPtr++]=t,this.backPtr>=this.stride&&(this.backPtr=0))}shift(){if(this.vips.length>0)return this.vips.pop();{const t=this.entries[this.frontPtr++];return this.frontPtr>=this.stride&&(this.frontPtr=0),this.frontPtr===this.backPtr&&(this.frontPtr=this.stride%this.overflowPtr,this.backPtr=0,this.stride=this.overflowPtr),t}}unshift(t){(this.backPtr+1)%this.stride===this.frontPtr?this.vips.push(t):(--this.frontPtr<0&&(this.frontPtr=this.stride-1),this.entries[this.frontPtr]=t)}}const G=["","webkit","moz","ms"];var Q=function(t,e,r,i){return new(r||(r=Promise))(function(n,s){function a(t){try{u(i.next(t))}catch(t){s(t)}}function o(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(a,o)}u((i=i.apply(t,e||[])).next())})};const K=function(t,e=window){const r=G.map(e=>`${e}${t}`).find(t=>t in e);return e[r]}("AudioContext");class z{constructor(t){this.context=new K({sampleRate:t}),this.gainer=this.context.createGain(),this.gainer.gain.value=1,this.gainer.connect(this.context.destination)}get volume(){return this.gainer.gain.value}set volume(t){this.gainer.gain.value=t}}class V{static fromFile(t){return Q(this,void 0,void 0,function*(){const e=yield function(t){return u(this,void 0,void 0,function*(){return new Promise((e,r)=>{const i=new Audio;i.onloadedmetadata=()=>e(i),i.onerror=()=>r(new Error(`Unable to load audio file '${t}'`)),i.src=t})})}(t);return e.loop=!0,new this(e)})}constructor(t){this.media=t}get length(){return this.media.duration}get position(){return this.media.currentTime}get repeat(){return this.media.loop}get volume(){return this.media.volume}set position(t){this.media.currentTime=t}set repeat(t){this.media.loop=t}set volume(t){this.media.volume=t}pause(){this.media.pause()}play(t){t!==this.mixer&&(this.mixer=t,void 0!==this.node&&this.node.disconnect(),this.node=t.context.createMediaElementSource(this.media),this.node.connect(t.gainer)),this.media.play()}stop(){this.media.pause(),this.media.currentTime=0}}class W{constructor(t,e){this.buffers=new j,this.inputPtr=0,this.mixer=null,this.paused=!0,this.timeBuffered=0,this.numChannels=e,this.sampleRate=t}get buffered(){return this.timeBuffered}buffer(t){this.buffers.push(t),this.timeBuffered+=t.length/(this.sampleRate*this.numChannels)}pause(){this.paused=!0}play(t){this.paused=!1,void 0!==t&&t!==this.mixer&&(void 0!==this.node&&(this.node.onaudioprocess=null,this.node.disconnect()),this.node=t.context.createScriptProcessor(0,0,this.numChannels),this.node.onaudioprocess=t=>{const e=[];for(let r=0;r<this.numChannels;++r)e[r]=t.outputBuffer.getChannelData(r);if(this.paused||this.timeBuffered<t.outputBuffer.duration){for(let t=0;t<this.numChannels;++t)e[t].fill(0);return}this.timeBuffered-=t.outputBuffer.duration,this.timeBuffered<0&&(this.timeBuffered=0);const r=this.sampleRate/t.outputBuffer.sampleRate;let i=this.buffers.first,n=this.inputPtr;for(let t=0,s=e[0].length;t<s;++t){const s=Math.floor(n)*this.numChannels,a=s+this.numChannels,o=n%1;for(let r=0;r<this.numChannels;++r){const n=i[s+r],u=i[a+r];e[r][t]=n+o*(u-n)}if((n+=r)>=Math.floor(i.length/this.numChannels)){if(this.buffers.shift(),this.buffers.empty){for(let r=0;r<this.numChannels;++r)e[r].fill(0,t+1);return}n-=Math.floor(i.length/this.numChannels),i=this.buffers.first}}this.inputPtr=n},this.node.connect(t.gainer),this.mixer=t)}stop(){void 0!==this.node&&(this.node.onaudioprocess=null,this.node.disconnect()),this.buffers.clear(),this.inputPtr=0,this.mixer=null,this.node=void 0,this.paused=!0,this.timeBuffered=0}}var $=function(t,e,r,i){return new(r||(r=Promise))(function(n,s){function a(t){try{u(i.next(t))}catch(t){s(t)}}function o(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(a,o)}u((i=i.apply(t,e||[])).next())})};class q{static fromDirectory(t){return $(this,void 0,void 0,function*(){const e=yield d(`${t}/game.json`);return new this(t,e)})}static urlOf(t,e){const r=e.split(/[\\\/]+/);if("@"!==r[0]&&"#"!==r[0]&&"~"!==r[0]&&"$"!==r[0]&&"%"!==r[0]&&r.unshift("@"),"@"===r[0]){if(null===t)throw new Error("No game loaded to resolve SphereFS '@/' prefix");return r.splice(0,1),`${t.url}/${r.join("/")}`}if("#"===r[0])return r.splice(0,1),`./assets/${r.join("/")}`;throw new RangeError(`Unsupported SphereFS prefix '${r[0]}'`)}constructor(t,e){const r=JSON.parse(e);this.url=t,this.data=r;const i=this.data.resolution.match(/^([0-9]*)x([0-9]*)$/);this.screenSize=null!==i?Object.freeze({x:+i[1],y:+i[2]}):Object.freeze({x:640,y:480})}get author(){return this.data.author}get compiler(){return this.data.$COMPILER}get modulePath(){return this.data.main}get manifest(){return this.data}get resolution(){return this.screenSize}get summary(){return this.data.summary}get title(){return this.data.name}fullPath(t,e="@/"){"@/"!==e&&(e=this.fullPath(`${e}/`));const r=(/^[@#~$%](?:\\|\/)/.test(t)?`${t}`:`${e}/${t}`).split(/[\\\/]+/);"$"===r[0]&&r.splice(0,1,...this.data.main.split(/[\\\/]+/).slice(0,-1));const i=[r[0]];for(let e=1,n=r.length;e<n;++e)if(".."===r[e]){if(!(i.length>1))throw new RangeError(`FS sandbox violation on '${t}'`);i.pop()}else"."!==r[e]&&i.push(r[e]);return i.join("/")}}var H,Y=function(t,e,r,i){return new(r||(r=Promise))(function(n,s){function a(t){try{u(i.next(t))}catch(t){s(t)}}function o(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(a,o)}u((i=i.apply(t,e||[])).next())})};!function(t){t[t.Read=0]="Read",t[t.Update=1]="Update",t[t.Write=2]="Write"}(H||(H={}));const X=window.console,J=new class{constructor(){this.frameCount=-1,this.jobQueue=[],this.rafCallback=this.animate.bind(this),this.rafID=0,this.sortNeeded=!1}addJob(t,e,r=!1,i=0){const n=r?0:i;let s=r?i:0;return t===C.Render&&(s=-s),this.jobQueue.push({jobID:_,type:t,callback:e,priority:s,recurring:r,running:!1,timer:n}),this.sortNeeded=!0,_++}animate(t){this.rafID=requestAnimationFrame(this.rafCallback),++this.frameCount,x.Screen.activate(),x.Screen.unclip(),A.clear(),this.runJobs(C.Render),this.runJobs(C.Update),this.runJobs(C.Immediate)}cancelJob(t){let e=0;for(let r=0,i=this.jobQueue.length;r<i;++r){const i=this.jobQueue[r];i.jobID!==t&&(this.jobQueue[e++]=i)}this.jobQueue.length=e}now(){return Math.max(this.frameCount,0)}runJobs(t){this.sortNeeded&&(this.jobQueue.sort((t,e)=>{const r=e.priority-t.priority,i=t.jobID-e.jobID;return 0!==r?r:i}),this.sortNeeded=!1);for(const e of this.jobQueue)e.type===t&&!e.running&&(e.recurring||e.timer--<=0)&&(e.running=!0,f(e.callback).then(()=>e.running=!1));let e=0;for(let t=0,r=this.jobQueue.length;t<r;++t){const r=this.jobQueue[t];!r.recurring&&r.timer<0||(this.jobQueue[e++]=r)}this.jobQueue.length=e}start(){0===this.rafID&&(this.rafID=requestAnimationFrame(this.rafCallback))}stop(){0!==this.rafID&&cancelAnimationFrame(this.rafID),this.frameCount=0,this.jobQueue.length=0,this.rafID=0}};let Z,tt,et,rt,it,nt,st;class at extends(null){static initialize(t){nt=t,it=new U,Object.defineProperty(window,"global",{writable:!1,enumerable:!1,configurable:!1,value:window}),Object.assign(window,{BlendOp:y,DepthOp:v,FileOp:H,Key:E,MouseKey:S,ShapeType:D,Sphere:ot,Color:ut,Dispatch:ht,FS:lt,FileStream:ct,Font:dt,IndexList:ft,Joystick:pt,Keyboard:mt,Mixer:wt,Model:bt,Mouse:yt,SSj:vt,Shader:Dt,Shape:Et,Sound:St,SoundStream:kt,Surface:Pt,Texture:xt,Transform:Rt,VertexList:Tt}),Object.defineProperty(JSON,"fromFile",{writable:!0,enumerable:!1,configurable:!0,value:function(t){return Y(this,void 0,void 0,function*(){return h(q.urlOf(rt,t))})}})}static launchGame(t){return Y(this,void 0,void 0,function*(){rt=yield q.fromDirectory(t),A.rerez(rt.resolution.x,rt.resolution.y),document.title=rt.title,Z=yield dt.fromFile("#/default.rfn"),tt=yield Dt.fromFiles({vertexFile:"#/default.vert.glsl",fragmentFile:"#/default.frag.glsl"});const e=q.urlOf(rt,rt.modulePath),r=yield l(e);return!function(t){const e=new Proxy(t,{construct:()=>({})});try{return Reflect.construct(e,[]),!0}catch(t){return!1}}(r.default)?r.default():"function"==typeof(st=new r.default).start&&st.start(),et=new M,J.addJob(C.Render,()=>{if(et.progress>=1)return;const t=`fido/${Math.floor(100*et.progress)}%`,e=Z.getTextSize(t),r=Pt.Screen.width-e.width-5,i=Pt.Screen.height-e.height-5;Z.drawText(Pt.Screen,r+1,i+1,t,ut.Black),Z.drawText(Pt.Screen,r,i,t,ut.Silver)},!0,1/0),J.start(),rt})}}class ot extends(null){static get APILevel(){return a}static get Compiler(){return rt.compiler}static get Engine(){return`${i} ${n}`}static get Game(){return rt.manifest}static get Version(){return s}static get frameRate(){return 60}static get frameSkip(){return 0}static get fullScreen(){return!1}static set frameRate(t){throw new Error("Oozaru doesn't support setting the frame rate")}static set frameSkip(t){throw new Error("Oozaru doesn't support frameskip")}static set fullScreen(t){if(!1!==t)throw new Error("Oozaru doesn't yet support fullScreen mode")}static get main(){return st}static now(){return J.now()}static sleep(t){return new Promise(e=>{J.addJob(C.Update,e,!1,t)})}static setResolution(t,e){A.rerez(t,e)}}class ut{static get AliceBlue(){return new ut(240/255,248/255,1,1)}static get AntiqueWhite(){return new ut(250/255,235/255,215/255,1)}static get Aqua(){return new ut(0,1,1,1)}static get Aquamarine(){return new ut(127/255,1,212/255,1)}static get Azure(){return new ut(240/255,1,1,1)}static get Beige(){return new ut(245/255,245/255,220/255,1)}static get Bisque(){return new ut(1,228/255,196/255,1)}static get Black(){return new ut(0,0,0,1)}static get BlanchedAlmond(){return new ut(1,235/255,205/255,1)}static get Blue(){return new ut(0,0,1,1)}static get BlueViolet(){return new ut(138/255,43/255,226/255,1)}static get Brown(){return new ut(165/255,42/255,42/255,1)}static get BurlyWood(){return new ut(222/255,184/255,135/255,1)}static get CadetBlue(){return new ut(95/255,158/255,160/255,1)}static get Chartreuse(){return new ut(127/255,1,0,1)}static get Chocolate(){return new ut(210/255,105/255,30/255,1)}static get Coral(){return new ut(1,127/255,80/255,1)}static get CornflowerBlue(){return new ut(100/255,149/255,237/255,1)}static get Cornsilk(){return new ut(1,248/255,220/255,1)}static get Crimson(){return new ut(220/255,20/255,60/255,1)}static get Cyan(){return new ut(0,1,1,1)}static get DarkBlue(){return new ut(0,0,139/255,1)}static get DarkCyan(){return new ut(0,139/255,139/255,1)}static get DarkGoldenrod(){return new ut(184/255,134/255,11/255,1)}static get DarkGray(){return new ut(169/255,169/255,169/255,1)}static get DarkGreen(){return new ut(0,100/255,0,1)}static get DarkKhaki(){return new ut(189/255,183/255,107/255,1)}static get DarkMagenta(){return new ut(139/255,0,139/255,1)}static get DarkOliveGreen(){return new ut(85/255,107/255,47/255,1)}static get DarkOrange(){return new ut(1,140/255,0,1)}static get DarkOrchid(){return new ut(.6,50/255,.8,1)}static get DarkRed(){return new ut(139/255,0,0,1)}static get DarkSalmon(){return new ut(233/255,150/255,122/255,1)}static get DarkSeaGreen(){return new ut(143/255,188/255,143/255,1)}static get DarkSlateBlue(){return new ut(72/255,61/255,139/255,1)}static get DarkSlateGray(){return new ut(47/255,79/255,79/255,1)}static get DarkTurquoise(){return new ut(0,206/255,209/255,1)}static get DarkViolet(){return new ut(148/255,0,211/255,1)}static get DeepPink(){return new ut(1,20/255,147/255,1)}static get DeepSkyBlue(){return new ut(0,191/255,1,1)}static get DimGray(){return new ut(105/255,105/255,105/255,1)}static get DodgerBlue(){return new ut(30/255,144/255,1,1)}static get FireBrick(){return new ut(178/255,34/255,34/255,1)}static get FloralWhite(){return new ut(1,250/255,240/255,1)}static get ForestGreen(){return new ut(34/255,139/255,34/255,1)}static get Fuchsia(){return new ut(1,0,1,1)}static get Gainsboro(){return new ut(220/255,220/255,220/255,1)}static get GhostWhite(){return new ut(248/255,248/255,1,1)}static get Gold(){return new ut(1,215/255,0,1)}static get Goldenrod(){return new ut(218/255,165/255,32/255,1)}static get Gray(){return new ut(128/255,128/255,128/255,1)}static get Green(){return new ut(0,128/255,0,1)}static get GreenYellow(){return new ut(173/255,1,47/255,1)}static get Honeydew(){return new ut(240/255,1,240/255,1)}static get HotPink(){return new ut(1,105/255,180/255,1)}static get IndianRed(){return new ut(205/255,92/255,92/255,1)}static get Indigo(){return new ut(75/255,0,130/255,1)}static get Ivory(){return new ut(1,1,240/255,1)}static get Khaki(){return new ut(240/255,230/255,140/255,1)}static get Lavender(){return new ut(230/255,230/255,250/255,1)}static get LavenderBlush(){return new ut(1,240/255,245/255,1)}static get LawnGreen(){return new ut(124/255,252/255,0,1)}static get LemonChiffon(){return new ut(1,250/255,205/255,1)}static get LightBlue(){return new ut(173/255,216/255,230/255,1)}static get LightCoral(){return new ut(240/255,128/255,128/255,1)}static get LightCyan(){return new ut(224/255,1,1,1)}static get LightGoldenrodYellow(){return new ut(250/255,250/255,210/255,1)}static get LightGray(){return new ut(211/255,211/255,211/255,1)}static get LightGreen(){return new ut(144/255,238/255,144/255,1)}static get LightPink(){return new ut(1,182/255,193/255,1)}static get LightSalmon(){return new ut(1,160/255,122/255,1)}static get LightSeaGreen(){return new ut(32/255,178/255,170/255,1)}static get LightSkyBlue(){return new ut(135/255,206/255,250/255,1)}static get LightSlateGray(){return new ut(119/255,136/255,.6,1)}static get LightSteelBlue(){return new ut(176/255,196/255,222/255,1)}static get LightYellow(){return new ut(1,1,224/255,1)}static get Lime(){return new ut(0,1,0,1)}static get LimeGreen(){return new ut(50/255,205/255,50/255,1)}static get Linen(){return new ut(250/255,240/255,230/255,1)}static get Magenta(){return new ut(1,0,1,1)}static get Maroon(){return new ut(128/255,0,0,1)}static get MediumAquamarine(){return new ut(.4,205/255,170/255,1)}static get MediumBlue(){return new ut(0,0,205/255,1)}static get MediumOrchid(){return new ut(186/255,85/255,211/255,1)}static get MediumPurple(){return new ut(147/255,112/255,219/255,1)}static get MediumSeaGreen(){return new ut(60/255,179/255,113/255,1)}static get MediumSlateBlue(){return new ut(123/255,104/255,238/255,1)}static get MediumSpringGreen(){return new ut(0,250/255,154/255,1)}static get MediumTurquoise(){return new ut(72/255,209/255,.8,1)}static get MediumVioletRed(){return new ut(199/255,21/255,133/255,1)}static get MidnightBlue(){return new ut(25/255,25/255,112/255,1)}static get MintCream(){return new ut(245/255,1,250/255,1)}static get MistyRose(){return new ut(1,228/255,225/255,1)}static get Moccasin(){return new ut(1,228/255,181/255,1)}static get NavajoWhite(){return new ut(1,222/255,173/255,1)}static get Navy(){return new ut(0,0,128/255,1)}static get OldLace(){return new ut(253/255,245/255,230/255,1)}static get Olive(){return new ut(128/255,128/255,0,1)}static get OliveDrab(){return new ut(107/255,142/255,35/255,1)}static get Orange(){return new ut(1,165/255,0,1)}static get OrangeRed(){return new ut(1,69/255,0,1)}static get Orchid(){return new ut(218/255,112/255,214/255,1)}static get PaleGoldenrod(){return new ut(238/255,232/255,170/255,1)}static get PaleGreen(){return new ut(152/255,251/255,152/255,1)}static get PaleTurquoise(){return new ut(175/255,238/255,238/255,1)}static get PaleVioletRed(){return new ut(219/255,112/255,147/255,1)}static get PapayaWhip(){return new ut(225/255,239/255,213/255,1)}static get PeachPuff(){return new ut(1,218/255,185/255,1)}static get Peru(){return new ut(205/255,133/255,63/255,1)}static get Pink(){return new ut(1,192/255,203/255,1)}static get Plum(){return new ut(221/255,160/255,221/255,1)}static get PowderBlue(){return new ut(176/255,224/255,230/255,1)}static get Purple(){return new ut(128/255,0,128/255,1)}static get Red(){return new ut(1,0,0,1)}static get RosyBrown(){return new ut(188/255,143/255,143/255,1)}static get RoyalBlue(){return new ut(65/255,105/255,225/255,1)}static get SaddleBrown(){return new ut(139/255,69/255,19/255,1)}static get Salmon(){return new ut(250/255,128/255,114/255,1)}static get SandyBrown(){return new ut(244/255,164/255,96/255,1)}static get SeaGreen(){return new ut(46/255,139/255,87/255,1)}static get Seashell(){return new ut(1,245/255,238/255,1)}static get Sienna(){return new ut(160/255,82/255,45/255,1)}static get Silver(){return new ut(192/255,192/255,192/255,1)}static get SkyBlue(){return new ut(135/255,206/255,235/255,1)}static get SlateBlue(){return new ut(106/255,90/255,205/255,1)}static get SlateGray(){return new ut(112/255,128/255,144/255,1)}static get Snow(){return new ut(1,250/255,250/255,1)}static get SpringGreen(){return new ut(0,1,127/255,1)}static get SteelBlue(){return new ut(70/255,130/255,180/255,1)}static get Tan(){return new ut(210/255,180/255,140/255,1)}static get Teal(){return new ut(0,128/255,128/255,1)}static get Thistle(){return new ut(216/255,191/255,216/255,1)}static get Tomato(){return new ut(1,99/255,71/255,1)}static get Transparent(){return new ut(0,0,0,0)}static get Turquoise(){return new ut(64/255,224/255,208/255,1)}static get Violet(){return new ut(238/255,130/255,238/255,1)}static get Wheat(){return new ut(245/255,222/255,179/255,1)}static get White(){return new ut(1,1,1,1)}static get WhiteSmoke(){return new ut(245/255,245/255,245/255,1)}static get Yellow(){return new ut(1,1,0,1)}static get YellowGreen(){return new ut(154/255,205/255,50/255,1)}static get PurwaBlue(){return new ut(155/255,225/255,1,1)}static get RebeccaPurple(){return new ut(.4,.2,.6,1)}static get StankyBean(){return new ut(197/255,162/255,171/255,1)}static is(t,e){return t.zit.r===e.zit.r&&t.zit.g===e.zit.g&&t.zit.b===e.zit.b}static mix(t,e,r=1,i=1){const n=r+i,s=(r*t.zit.r+i*e.zit.r)/n,a=(r*t.zit.g+i*e.zit.g)/n,o=(r*t.zit.b+i*e.zit.b)/n,u=(r*t.zit.a+i*e.zit.a)/n;return new ut(s,a,o,u)}static of(t){let e=t.match(/^#?([0-9a-f]{6})$/i);if(e){const t=e[1];return new ut(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255)}if(e=t.match(/^#?([0-9a-f]{8})$/i)){const t=e[1];return new ut(parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,parseInt(t.substr(6,2),16)/255,parseInt(t.substr(0,2),16)/255)}const r=t.toUpperCase();for(let t in ut)if(t.toUpperCase()===r){try{let e=ut[t];if(e instanceof ut)return e}catch(t){}break}throw new RangeError(`Invalid color designation '${t}'`)}constructor(t,e,r,i=1){this.zit={r:t,g:e,b:r,a:i}}get name(){throw new Error("API not implemented")}get r(){return this.zit.r}get g(){return this.zit.g}get b(){return this.zit.b}get a(){return this.zit.a}set r(t){this.zit.r=Math.min(Math.max(t,0),1)}set g(t){this.zit.g=Math.min(Math.max(t,0),1)}set b(t){this.zit.b=Math.min(Math.max(t,0),1)}set a(t){this.zit.a=Math.min(Math.max(t,0),1)}clone(){return new ut(this.zit.r,this.zit.g,this.zit.b,this.zit.a)}fadeTo(t){return new ut(this.zit.r,this.zit.g,this.zit.b,this.zit.a*t)}}class ht extends(null){static cancelAll(){throw new Error("API not implemented")}static later(t,e){const r=J.addJob(C.Update,e,!1,t);return new gt(r)}static now(t){const e=J.addJob(C.Immediate,t);return new gt(e)}static onRender(t,e={}){const r=J.addJob(C.Render,t,!0,e.priority);return new gt(r)}static onUpdate(t,e={}){const r=J.addJob(C.Update,t,!0,e.priority);return new gt(r)}}class lt extends(null){static evaluateScript(t){return Y(this,void 0,void 0,function*(){return function(t){return u(this,void 0,void 0,function*(){return new Promise((e,r)=>{const i=document.createElement("script");i.onload=()=>{e(),i.remove()},i.onerror=()=>{r(new Error(`Unable to load JS script '${t}'`)),i.remove()},i.src=t,document.head.appendChild(i)})})}(q.urlOf(rt,t))})}static fileExists(t){return Y(this,void 0,void 0,function*(){const e=q.urlOf(rt,t);try{return 200===(yield fetch(e)).status}catch(t){return!1}})}static fullPath(t,e){return rt.fullPath(t,e)}static require(t){return Y(this,void 0,void 0,function*(){const e=q.urlOf(rt,t);return e.endsWith(".js")||e.endsWith(".mjs")?l(e):h(e)})}}class ct{static open(t,e){return Y(this,void 0,void 0,function*(){if(e!==H.Read)throw new RangeError("Oozaru currently only supports FileStreams in read mode");const r=q.urlOf(rt,t),i=yield c(r),n=Object.create(this.prototype);return n.fullPath=t,n.stream=new o(i),n})}constructor(){throw new RangeError("'new FileStream' is unsupported, use 'FileStream.open' instead")}get fileName(){return this.fullPath}get fileSize(){if(null===this.stream)throw new Error("The FileStream has already been disposed");return this.stream.bufferSize}get position(){if(null===this.stream)throw new Error("The FileStream has already been disposed");return this.stream.position}set position(t){if(null===this.stream)throw new Error("The FileStream has already been disposed");this.stream.position=t}dispose(){this.stream=null}read(t){if(null===this.stream)throw new Error("The FileStream has already been disposed");return this.stream.readBytes(t).buffer}write(t){if(null===this.stream)throw new Error("The FileStream has already been disposed");throw new Error("Oozaru doesn't yet support FileStream#write()")}}class dt{static get Default(){return Object.defineProperty(dt,"Default",{writable:!1,enumerable:!1,configurable:!0,value:Z}),Z}static fromFile(t){return Y(this,void 0,void 0,function*(){const e=q.urlOf(rt,t),r=yield P.fromFile(e),i=Object.create(this.prototype);return i.font=r,i})}constructor(t){this.font=Z.font;const e=q.urlOf(rt,t);P.fromFile(e).then(t=>{this.font=t})}get height(){return this.font.height}drawText(t,e,r,i,n=ut.White,s){const a=T.Identity.translate(e,r);if(t.drawTarget.activate(),Dt.Default.program.activate(!1),Dt.Default.program.project(t.projection.matrix),void 0!==s){const t=this.wordWrap(String(i),s);for(let e=0,r=t.length;e<r;++e)this.font.drawText(t[e],n,a),a.translate(0,this.font.height)}else this.font.drawText(String(i),n,a)}getTextSize(t,e){if(void 0!==e){return{width:e,height:this.font.wordWrap(String(t),e).length*this.font.height}}return{width:this.font.widthOf(String(t)),height:this.font.height}}widthOf(t){return this.font.widthOf(String(t))}wordWrap(t,e){return this.font.wordWrap(String(t),e)}}class ft{constructor(t){this.buffer=new R(t)}}class gt{constructor(t){this.jobID=t}cancel(){J.cancelJob(this.jobID)}}class pt{static get P1(){return At(this,"P1",new pt)}static get P2(){return At(this,"P2",new pt)}static get P3(){return At(this,"P3",new pt)}static get P4(){return At(this,"P4",new pt)}static getDevices(){return[]}get name(){return"null joystick"}get numAxes(){return 0}get numButtons(){return 0}getPosition(){return 0}isPressed(){return!1}}class mt{static get Default(){const t=new mt;return Object.defineProperty(mt,"Default",{writable:!1,enumerable:!1,configurable:!0,value:t}),t}get capsLock(){return!1}get numLock(){return!1}get scrollLock(){return!1}charOf(t,e=!1){return t===E.Space?" ":t===E.Backslash?e?"|":"\\":t===E.Period?e?">":".":t===E.Slash?e?"?":"/":t===E.Tilde?e?"~":"`":t===E.D0?e?")":"0":t===E.D1?e?"!":"1":t===E.D2?e?"@":"2":t===E.D3?e?"#":"3":t===E.D4?e?"$":"4":t===E.D5?e?"%":"5":t===E.D6?e?"^":"6":t===E.D7?e?"&":"7":t===E.D8?e?"*":"8":t===E.D9?e?"(":"9":t===E.A?e?"A":"a":t===E.B?e?"B":"b":t===E.C?e?"C":"c":t===E.D?e?"D":"d":t===E.E?e?"E":"e":t===E.F?e?"F":"f":t===E.G?e?"G":"g":t===E.H?e?"H":"h":t===E.I?e?"I":"i":t===E.J?e?"J":"j":t===E.K?e?"K":"k":t===E.L?e?"L":"l":t===E.M?e?"M":"m":t===E.N?e?"N":"n":t===E.O?e?"O":"o":t===E.P?e?"P":"p":t===E.Q?e?"Q":"q":t===E.R?e?"R":"r":t===E.S?e?"S":"s":t===E.T?e?"T":"t":t===E.U?e?"U":"u":t===E.V?e?"V":"v":t===E.W?e?"W":"w":t===E.X?e?"X":"x":t===E.Y?e?"Y":"y":t===E.Z?e?"Z":"z":""}clearQueue(){nt.clearKeyQueue()}getKey(){return nt.getKey()}isPressed(t){return nt.isKeyDown(t)}}class wt{static get Default(){const t=new wt(44100,16,2);return Object.defineProperty(wt,"Default",{writable:!1,enumerable:!1,configurable:!0,value:t}),t}constructor(t,e,r){this.mixer=new z(t)}get volume(){return this.mixer.volume}set volume(t){this.mixer.volume=t}}class bt{constructor(t,e=Dt.Default){this.shapes=[...t],this.shader_=e,this.transform_=new Rt}get shader(){return this.shader_}set shader(t){this.shader_=t}get transform(){return this.transform_}set transform(t){this.transform_=t}draw(t=Pt.Screen){t.drawTarget.activate(),this.shader_.program.project(t.projection.matrix),this.shader_.program.transform(this.transform_.matrix);for(const t of this.shapes)this.shader_.program.activate(null!==t.texture),null!==t.texture&&t.texture.texture.activate(0),t.shape.draw()}}class yt{static get Default(){const t=new yt;return Object.defineProperty(yt,"Default",{writable:!1,enumerable:!1,configurable:!0,value:t}),t}get x(){return nt.mouseX}get y(){return nt.mouseY}clearQueue(){nt.clearMouseQueue()}getEvent(){return nt.getMouseEvent()}isPressed(t){return nt.isMouseKeyDown(t)}}class vt extends(null){static log(t){X.log(t)}static now(){return performance.now()/1e3}}class Dt{static get Default(){return Object.defineProperty(Dt,"Default",{writable:!1,enumerable:!1,configurable:!0,value:tt}),tt}static fromFiles(t){return Y(this,void 0,void 0,function*(){const e=q.urlOf(rt,t.vertexFile),r=q.urlOf(rt,t.fragmentFile),i=Object.create(this.prototype),[n,s]=yield Promise.all([d(e),d(r)]);return i.program=new F(n,s),i.vertSource=n,i.fragSource=s,i})}constructor(t){this.program=tt.clone().program;const e=q.urlOf(rt,t.vertexFile),r=q.urlOf(rt,t.fragmentFile);Promise.all([d(e),d(r)]).then(([t,e])=>{this.vertSource=t,this.fragSource=e,this.program=new F(t,e)})}clone(){if(void 0===this.vertSource||void 0===this.fragSource)throw new Error("Cannot clone shader before fully loaded");const t=Object.create(Object.getPrototypeOf(this));return t.vertSource=this.vertSource,t.fragSource=this.fragSource,t.program=new F(t.vertSource,t.fragSource),t}setBoolean(t,e){this.program.setBoolValue(t,e)}setColorVector(t,e){this.program.setFloatVec(t,[e.zit.r,e.zit.g,e.zit.b,e.zit.a])}setFloat(t,e){this.program.setFloatValue(t,e)}setFloatArray(t,e){this.program.setFloatArray(t,e)}setFloatVector(t,e){this.program.setFloatVec(t,e)}setInt(t,e){this.program.setIntValue(t,e)}setIntArray(t,e){this.program.setIntArray(t,e)}setIntVector(t,e){this.program.setIntVec(t,e)}setMatrix(t,e){this.program.setMatrixValue(t,e.matrix)}}class Et{static drawImmediate(t,e,r,i){t.drawTarget.activate(),r instanceof xt||null===r?(Dt.Default.program.activate(null!==r),Dt.Default.program.project(t.projection.matrix),Dt.Default.program.transform(T.Identity),null!==r&&r.texture.activate(0),it.upload(i),A.draw(it,null,e)):(Dt.Default.program.activate(!1),Dt.Default.program.project(t.projection.matrix),Dt.Default.program.transform(T.Identity),it.upload(r),A.draw(it,null,e))}constructor(t,e,r=null,i=null){if(r instanceof Tt){if(!(e instanceof xt)&&null!=e)throw new Error("Expected Texture or null as second parameter to new Shape");const n=r.buffer,s=null!==i?i.buffer:null;this.shape=new L(n,s,t),this.texture=e,this.indexList=i}else{if(!(e instanceof Tt))throw new Error("Expected VertexList or Texture as second parameter to new Shape");let i=e.buffer;const n=null!==r?r.buffer:null;this.shape=new L(i,n,t),this.texture=null,this.indexList=r}}draw(t=Pt.Screen,e=Rt.Identity,r=Dt.Default){t.drawTarget.activate(),r.program.activate(null!==this.texture),r.program.project(t.projection.matrix),r.program.transform(e.matrix),null!==this.texture&&this.texture.texture.activate(0),this.shape.draw()}}class St{constructor(t){this.initialState={mixer:wt.Default,playing:!1,position:0,repeat:!0,volume:1};const e=q.urlOf(rt,t);V.fromFile(e).then(t=>{t.position=this.initialState.position,t.repeat=this.initialState.repeat,t.volume=this.initialState.volume,this.initialState.playing&&t.play(this.initialState.mixer.mixer),this.sound=t})}static fromFile(t){return Y(this,void 0,void 0,function*(){const e=q.urlOf(rt,t),r=Object.create(this.prototype);return r.sound=yield V.fromFile(e),r})}get length(){return void 0!==this.sound?this.sound.length:0}get position(){return void 0!==this.sound?this.sound.position:this.initialState.position}set position(t){void 0!==this.sound?this.sound.position=t:this.initialState.position=t}get repeat(){return void 0!==this.sound?this.sound.repeat:this.initialState.repeat}set repeat(t){void 0!==this.sound?this.sound.repeat=t:this.initialState.repeat=t}get volume(){return void 0!==this.sound?this.sound.volume:this.initialState.volume}set volume(t){void 0!==this.sound?this.sound.volume=t:this.initialState.volume=t}pause(){void 0!==this.sound?this.sound.pause():this.initialState.playing=!1}play(t=wt.Default){void 0!==this.sound?this.sound.play(t.mixer):(this.initialState.playing=!0,this.initialState.mixer=t)}stop(){void 0!==this.sound?this.sound.stop():(this.initialState.playing=!1,this.initialState.position=0)}}class kt{constructor(t,e,r){if(32!==e)throw new RangeError("Only 32-bit floating-point audio is supported in Oozaru");this.stream=new W(t,r)}get length(){return this.stream.buffered}pause(){this.stream.pause()}play(t=wt.Default){this.stream.play(t.mixer)}stop(){this.stream.stop()}write(t){this.stream.buffer(t)}}class xt{static fromFile(t){return Y(this,void 0,void 0,function*(){const e=q.urlOf(rt,t),r=yield et.fetchImage(e);return new xt(r)})}constructor(...t){if("string"==typeof t[0]){this.texture=new O(1,1,ut.Transparent);const e=q.urlOf(rt,t[0]);et.fetchImage(e).then(t=>{this.texture=new O(t)})}else if(t[0]instanceof HTMLImageElement){const e=t[0];this.texture=new O(e)}else{const e=t[0],r=t[1],i=t[2];this.texture=new O(e,r,i)}}get height(){return this.texture.height}get width(){return this.texture.width}}class Pt extends xt{static get Screen(){const t=x.Screen,e=Object.create(Pt.prototype);return e.drawTarget=t,e.projection=(new Rt).project2D(0,0,t.width,t.height),Object.defineProperty(this,"Screen",{writable:!1,enumerable:!1,configurable:!0,value:e}),e}constructor(...t){super(...t),this.drawTarget=new x(this.texture),this.projection=(new Rt).project2D(0,0,this.drawTarget.width,this.drawTarget.height)}get blendOp(){return this.drawTarget.blendOp}set blendOp(t){this.drawTarget.blendOp=t}get depthOp(){return this.drawTarget.depthOp}set depthOp(t){this.drawTarget.depthOp=t}get height(){return this.drawTarget.height}get transform(){return this.projection}set transform(t){this.projection=t}get width(){return this.drawTarget.width}clipTo(t,e,r,i){this.drawTarget.clipTo(t,e,r,i)}}class Rt{static get Identity(){return new this}constructor(){this.matrix=new T,this.matrix.identity()}compose(t){return this.matrix.composeWith(t.matrix),this}identity(){return this.matrix.identity(),this}project2D(t,e,r,i,n=-1,s=1){return this.matrix.ortho(t,e,r,i,n,s),this}project3D(t,e,r,i){const n=Math.tan(t*Math.PI/360)*r,s=n*e;return this.matrix.perspective(-s,-n,s,n,r,i),this}rotate(t,e=0,r=0,i=1){const n=Math.sqrt(e*e+r*r+i*i);n>0&&(e/=n,r/=n,i/=n);const s=t*Math.PI/180;return this.matrix.rotate(s,e,r,i),this}scale(t,e,r=1){return this.matrix.scale(t,e,r),this}translate(t,e,r=0){return this.matrix.translate(t,e,r),this}}class Tt{constructor(t){this.buffer=new U([...t])}}function At(t,e,r){return Object.defineProperty(t,e,{writable:!1,enumerable:!1,configurable:!0,value:r}),r}var Ft=function(t,e,r,i){return new(r||(r=Promise))(function(n,s){function a(t){try{u(i.next(t))}catch(t){s(t)}}function o(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(a,o)}u((i=i.apply(t,e||[])).next())})};const Lt=document.getElementById("screen"),Ot=new class{constructor(t){this.buttonDown={},this.keyQueue=[],this.lastMouseX=void 0,this.lastMouseY=void 0,this.mouseQueue=[],this.pressed={"":!1},t.addEventListener("contextmenu",t=>t.preventDefault()),t.addEventListener("keydown",t=>{switch(t.preventDefault(),this.pressed[t.code]=!0,t.code){case"ArrowLeft":this.keyQueue.push(E.Left);break;case"ArrowRight":this.keyQueue.push(E.Right);break;case"ArrowDown":this.keyQueue.push(E.Down);break;case"ArrowUp":this.keyQueue.push(E.Up);break;case"Backquote":this.keyQueue.push(E.Tilde);break;case"Backslash":this.keyQueue.push(E.Backslash);break;case"Backspace":this.keyQueue.push(E.Backspace);break;case"Digit0":this.keyQueue.push(E.D0);break;case"Digit1":this.keyQueue.push(E.D1);break;case"Digit2":this.keyQueue.push(E.D2);break;case"Digit3":this.keyQueue.push(E.D3);break;case"Digit4":this.keyQueue.push(E.D4);break;case"Digit5":this.keyQueue.push(E.D5);break;case"Digit6":this.keyQueue.push(E.D6);break;case"Digit7":this.keyQueue.push(E.D7);break;case"Digit8":this.keyQueue.push(E.D8);break;case"Digit9":this.keyQueue.push(E.D9);break;case"End":this.keyQueue.push(E.End);break;case"Enter":this.keyQueue.push(E.Enter);break;case"Home":this.keyQueue.push(E.Home);break;case"KeyA":this.keyQueue.push(E.A);break;case"KeyB":this.keyQueue.push(E.B);break;case"KeyC":this.keyQueue.push(E.C);break;case"KeyD":this.keyQueue.push(E.D);break;case"KeyE":this.keyQueue.push(E.E);break;case"KeyF":this.keyQueue.push(E.F);break;case"KeyG":this.keyQueue.push(E.G);break;case"KeyH":this.keyQueue.push(E.H);break;case"KeyI":this.keyQueue.push(E.I);break;case"KeyJ":this.keyQueue.push(E.J);break;case"KeyK":this.keyQueue.push(E.K);break;case"KeyL":this.keyQueue.push(E.L);break;case"KeyM":this.keyQueue.push(E.M);break;case"KeyN":this.keyQueue.push(E.N);break;case"KeyO":this.keyQueue.push(E.O);break;case"KeyP":this.keyQueue.push(E.P);break;case"KeyQ":this.keyQueue.push(E.Q);break;case"KeyR":this.keyQueue.push(E.R);break;case"KeyS":this.keyQueue.push(E.S);break;case"KeyT":this.keyQueue.push(E.T);break;case"KeyU":this.keyQueue.push(E.U);break;case"KeyV":this.keyQueue.push(E.V);break;case"KeyW":this.keyQueue.push(E.W);break;case"KeyX":this.keyQueue.push(E.X);break;case"KeyY":this.keyQueue.push(E.Y);break;case"KeyZ":this.keyQueue.push(E.Z);break;case"PageDown":this.keyQueue.push(E.PageDown);break;case"PageUp":this.keyQueue.push(E.PageUp);break;case"Period":this.keyQueue.push(E.Period);break;case"Slash":this.keyQueue.push(E.Slash);break;case"Space":this.keyQueue.push(E.Space)}}),t.addEventListener("keyup",t=>{t.preventDefault(),this.pressed[t.code]=!1}),t.addEventListener("mousemove",t=>{t.preventDefault(),this.lastMouseX=t.offsetX,this.lastMouseY=t.offsetY}),t.addEventListener("mouseout",t=>{t.preventDefault(),this.lastMouseX=void 0,this.lastMouseY=void 0}),t.addEventListener("mousedown",e=>{e.preventDefault(),t.focus();const r=1===e.button?S.Middle:2===e.button?S.Right:3===e.button?S.Back:4===e.button?S.Forward:S.Left;this.buttonDown[r]=!0}),t.addEventListener("mouseup",t=>{t.preventDefault();const e=1===t.button?S.Middle:2===t.button?S.Right:3===t.button?S.Back:4===t.button?S.Forward:S.Left;this.buttonDown[e]=!1,this.mouseQueue.push({key:e,x:t.offsetX,y:t.offsetY})}),t.addEventListener("wheel",t=>{t.preventDefault();const e=t.deltaY<0?S.WheelUp:S.WheelDown;this.mouseQueue.push({key:e,delta:Math.abs(t.deltaY),x:t.offsetX,y:t.offsetY})})}get mouseX(){return this.lastMouseX}get mouseY(){return this.lastMouseY}clearKeyQueue(){this.keyQueue.length=0}clearMouseQueue(){this.mouseQueue.length=0}getKey(){const t=this.keyQueue.pop();return void 0!==t?t:null}getMouseEvent(){const t=this.mouseQueue.pop();return void 0!==t?t:null}isKeyDown(t){const e=t===E.Tilde?"Backquote":t===E.D0?"Digit0":t===E.D1?"Digit1":t===E.D2?"Digit2":t===E.D3?"Digit3":t===E.D4?"Digit4":t===E.D5?"Digit5":t===E.D6?"Digit6":t===E.D7?"Digit7":t===E.D8?"Digit8":t===E.D9?"Digit9":t===E.A?"KeyA":t===E.B?"KeyB":t===E.C?"KeyC":t===E.D?"KeyD":t===E.E?"KeyE":t===E.F?"KeyF":t===E.G?"KeyG":t===E.H?"KeyH":t===E.I?"KeyI":t===E.J?"KeyJ":t===E.K?"KeyK":t===E.L?"KeyL":t===E.M?"KeyM":t===E.N?"KeyN":t===E.O?"KeyO":t===E.P?"KeyP":t===E.Q?"KeyQ":t===E.R?"KeyR":t===E.S?"KeyS":t===E.T?"KeyT":t===E.U?"KeyU":t===E.V?"KeyV":t===E.W?"KeyW":t===E.X?"KeyX":t===E.Y?"KeyY":t===E.Z?"KeyZ":t===E.PageDown?"PageDown":t===E.PageUp?"PageUp":t===E.LShift?"ShiftLeft":t===E.LCtrl?"ControlLeft":t===E.Alt?"AltLeft":t===E.RShift?"ShiftRight":t===E.RCtrl?"ControlRight":t===E.AltGr?"AltRight":"";return this.pressed[e]}isMouseKeyDown(t){return!!this.buttonDown[t]}}(Lt);!function(){Ft(this,void 0,void 0,function*(){yield k.initialize(Lt),Lt.onclick=()=>Ft(this,void 0,void 0,function*(){Lt.onclick=null;const t=document.getElementById("prompt");let e;t.innerHTML="<tt><i>loading...</i></tt>",yield at.initialize(Ot);try{e=yield at.launchGame("./game/"),t.innerHTML=`\n\t\t\t\t<tt><i>${e.title}</i> by <b>${e.author}</b></tt><br>\n\t\t\t\t<tt>- <b>${i} ${n}</b> implementing <b>API v${s} level ${a}</b></tt><br>\n\t\t\t\t<tt>- game compiled with <b>${e.compiler}</b></tt><br>\n\t\t\t\t<tt>- backbuffer resolution is <b>${e.resolution.x}x${e.resolution.y}</b></tt><br>\n\t\t\t\t<br>\n\t\t\t\t<tt><b>About this Game:</b></tt><br>\n\t\t\t\t<tt>${e.summary}</tt>\n\t\t\t`}catch(e){throw t.innerHTML="<font color=#C88><tt>Unable to load Sphere game.  Check the console for more info.</tt></font>",e}})})}()}]);
//# sourceMappingURL=oozaru.js.map